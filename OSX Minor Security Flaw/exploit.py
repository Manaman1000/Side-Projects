# for some reason OSX seems to let specific incorrect passwords through
# is it even an OSX flaw? Needs more testing under different conditions

import zipfile
from threading import Thread

def extractFile(zFile, password):
    try:
        zFile.extractall(pwd=bytes(password, 'utf-8'))
        print('[+] Password found: {}'.format(password))
        return 1
    
    except Exception as e:
        #print(e)
        return 0
        
    
def main():
    zFile = zipfile.ZipFile('./evil.zip') # some random horrifically long password
    passFile = open('./dictionary.txt', 'r') # many of the dictionary words will work however
    lines = passFile.readlines()
    
    numLines = len(lines)
    openThreads = 0
    idx = 0
    threads = []
    
    while idx < numLines:
        word = lines[idx].strip('\n')
        
        if openThreads < 100:
            t = Thread(target=extractFile, args=(zFile, word))
            
            threads.append(t)
            threads[-1].start()
            
            openThreads += 1
            idx += 1
            
        else:
            for thread in threads:
                thread.join()
                
            threads = []
            openThreads = 0
    
    print('done')
            
if __name__ == '__main__':
    main()
